# ccman 重构设计文档（v2）

> **完全重构版设计文档索引**
>
> 基于 2025-12-07 深度分析和架构设计

---

## 📚 文档导航

### [00-现有功能总结.md](./00-现有功能总结.md)
**目标读者：** 所有人

**内容：**
- 基于 2025-12-07 代码分析
- 面向用户的现有功能清单
- 技术特性总结
- 功能覆盖矩阵
- 已知限制和改进空间

**为什么要读：**
- 确保重构后功能不回退
- 理解现有功能的范围和边界
- 作为重构的功能基线

---

### [01-新架构设计.md](./01-新架构设计.md)
**目标读者：** 开发者、架构师

**内容：**
- 完全重构的架构设计
- 分层架构详解（Interface → Core Services → Tool Drivers → Adapters）
- 核心概念（ToolDescriptor、Adapter、ToolRegistry）
- 数据流示例
- 模板系统设计
- 环境与路径管理
- 安全与可靠性保证

**为什么要读：**
- 理解新架构的核心理念："工具即插件"
- 了解如何实现真正的可扩展性
- 掌握各层的职责和交互

**关键收益：**
- ✅ 添加新工具只需 200-300 行代码
- ✅ CLI/Desktop 无需修改
- ✅ 完全解耦，类型安全

---

### [02-核心API定义.md](./02-核心API定义.md)
**目标读者：** 开发者、CLI 使用者

**内容：**
- 所有 Core API 的详细定义
- ToolRegistry API
- ProviderService API
- McpService API
- ConfigService API
- ToolOrchestrator API
- 路径管理 API
- 同步/导入导出 API
- 错误处理

**为什么要读：**
- 了解如何使用新 API
- 理解每个 Service 的职责
- 查看完整的使用示例

**实用性：**
- 包含大量代码示例
- 覆盖所有常见场景
- 可作为 API 参考手册

---

### [03-新工具添加指南.md](./03-新工具添加指南.md)
**目标读者：** 开发者、贡献者

**内容：**
- 完整的新工具添加流程（Step-by-Step）
- 以 CodeBuddy CLI 为示例
- 从零到完成的完整代码
- 测试和验证方法

**为什么要读：**
- 最实用的指南，手把手教你添加新工具
- 真实的代码示例（可直接复制）
- 验证新架构的可扩展性

**关键步骤：**
1. 创建工具目录
2. 实现 ToolDescriptor
3. 实现 Adapters
4. 注册工具（1 行代码）
5. 验证（CLI/Desktop 自动生成）

---

### [04-迁移计划.md](./04-迁移计划.md)
**目标读者：** 项目负责人、开发者

**内容：**
- 分阶段迁移策略（6 周计划）
- Phase 0: 准备期
- Phase 1: Core 重构（2 周）
- Phase 2: CLI 迁移（1 周）
- Phase 3: Desktop 迁移（1 周）
- Phase 4: 清理和发布（1 周）
- 兼容层设计
- 回滚策略
- 风险管理

**为什么要读：**
- 了解如何平稳过渡到新架构
- 确保向后兼容，用户无感知
- 学习如何管理大型重构项目

**核心原则：**
- ✅ 向后兼容（旧 API 保留）
- ✅ 渐进迁移（分阶段验证）
- ✅ 可随时回滚（兼容层 + 数据兼容）

---

## 🎯 快速开始

### 我是项目负责人
**推荐阅读顺序：**
1. [现有功能总结](./00-现有功能总结.md) - 了解基线
2. [新架构设计](./01-新架构设计.md) - 理解愿景
3. [迁移计划](./04-迁移计划.md) - 制定路线图

### 我是开发者
**推荐阅读顺序：**
1. [新架构设计](./01-新架构设计.md) - 理解架构
2. [核心 API 定义](./02-核心API定义.md) - 学习 API
3. [新工具添加指南](./03-新工具添加指南.md) - 实践操作

### 我想添加新工具
**推荐阅读顺序：**
1. [新工具添加指南](./03-新工具添加指南.md) - 手把手教程
2. [核心 API 定义](./02-核心API定义.md) - API 参考

### 我想了解迁移
**推荐阅读顺序：**
1. [迁移计划](./04-迁移计划.md) - 迁移策略
2. [新架构设计](./01-新架构设计.md) - 理解目标架构

---

## 🔥 核心亮点

### 完全可扩展
- 添加新工具只需 **200-300 行代码**
- CLI/Desktop **无需修改任何代码**
- 命令和 UI **自动生成**

### 统一接口
- 所有工具通过统一的 **Adapter 接口**管理
- **ServiceAdapter** - 服务商管理
- **McpAdapter** - MCP 管理
- **ConfigAdapter** - 配置文件管理

### 模板驱动
- 配置文件**完全模板化**
- 统一的 **TemplateEngine**
- **零硬编码**

### 类型安全
- **TypeScript** 类型约束
- **编译时错误检查**
- **IDE 智能提示**

### 零破坏性
- **向后兼容**（旧 API 保留）
- **数据兼容**（配置格式不变）
- **可随时回滚**

---

## 📊 对比总结

| 维度 | 现有架构 | 新架构 | 改进 |
|------|---------|--------|------|
| **扩展性** | 添加新工具需改多个文件 | 只需添加工具描述符和适配器 | ⭐⭐⭐⭐⭐ |
| **统一性** | 工具行为未完全统一 | 所有工具通过统一接口管理 | ⭐⭐⭐⭐⭐ |
| **模板** | 部分硬编码在代码中 | 完全文件模板驱动 | ⭐⭐⭐⭐⭐ |
| **ccman 抽象** | ccman 未被抽象 | ccman 也是工具实例之一 | ⭐⭐⭐⭐⭐ |
| **CLI/Desktop** | 每个工具硬编码命令/UI | 动态生成命令和 UI | ⭐⭐⭐⭐⭐ |
| **测试路径** | `/tmp/ccman-test-{PID}` | `/tmp/ccman-test`（固定）| ⭐⭐⭐ |
| **根目录切换** | 不支持持久化 | 支持持久化配置 | ⭐⭐⭐⭐ |

---

## 🚀 下一步

### 立即开始
1. **阅读设计文档**（推荐从 [新架构设计](./01-新架构设计.md) 开始）
2. **评审和讨论**（团队评审，提出改进建议）
3. **开始实施**（按照 [迁移计划](./04-迁移计划.md) 执行）

### 需要帮助？
- 提 Issue: https://github.com/your-org/ccman/issues
- 讨论区: https://github.com/your-org/ccman/discussions

---

## 📝 文档更新记录

| 版本 | 日期 | 作者 | 更新内容 |
|------|------|------|---------|
| v1.0 | 2025-12-07 | Claude | 初始版本，完整的重构设计文档 |

---

**感谢阅读！期待 ccman v2.0 的诞生！🎉**
