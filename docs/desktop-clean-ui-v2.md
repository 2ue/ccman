# Desktop æ¸…ç†åŠŸèƒ½ UI è®¾è®¡ V2ï¼ˆç®€åŒ–ç‰ˆï¼‰

## è®¾è®¡ç†å¿µ

åŸºäºç”¨æˆ·åé¦ˆé‡æ–°è®¾è®¡ï¼Œæ ¸å¿ƒåŸåˆ™ï¼š

1. **ç›´è§‚å±•ç¤º**ï¼šåˆ—è¡¨å±•ç¤ºæ‰€æœ‰æ•°æ®ï¼Œä¸ç”¨å›¾è¡¨
2. **ç»†ç²’åº¦æ§åˆ¶**ï¼šæ¯ä¸ªé¡¹ç›®/ç¼“å­˜éƒ½å¯å•ç‹¬åˆ é™¤
3. **å¿«é€Ÿæ“ä½œ**ï¼šé¡¶éƒ¨æä¾›3ä¸ªé¢„è®¾æ¸…ç†æŒ‰é’®
4. **ç®€æ´å®ç°**ï¼š3ä¸ªç»„ä»¶ï¼Œ~400è¡Œä»£ç 

---

## é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¸…ç†é…ç½®                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ CleanHeader (é¡¶éƒ¨æ§åˆ¶åŒº)                        â”‚   â”‚
â”‚ â”‚                                                 â”‚   â”‚
â”‚ â”‚ ğŸ“Š æ–‡ä»¶å¤§å°: 775.1 KB                          â”‚   â”‚
â”‚ â”‚                                                 â”‚   â”‚
â”‚ â”‚ [ä¿å®ˆæ¸…ç†] [ä¸­ç­‰æ¸…ç†] [æ¿€è¿›æ¸…ç†]     [åˆ·æ–°]     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ProjectHistoryTable (é¡¹ç›®å†å²è¡¨æ ¼)              â”‚   â”‚
â”‚ â”‚                                                 â”‚   â”‚
â”‚ â”‚ ğŸ“ é¡¹ç›®å†å²ä¼šè¯ (15ä¸ªé¡¹ç›®, 421æ¡è®°å½•)           â”‚   â”‚
â”‚ â”‚                                                 â”‚   â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚ â”‚ â”‚ é¡¹ç›®è·¯å¾„        â”‚æ¶ˆæ¯æ•°â”‚ å¤§å° â”‚æœ€åæ¶ˆæ¯â”‚æ“ä½œâ”‚   â”‚   â”‚
â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚   â”‚
â”‚ â”‚ â”‚ antool-mono    â”‚ 100 â”‚120KBâ”‚åˆ›å»ºç»„ä»¶  â”‚[åˆ ]â”‚   â”‚   â”‚
â”‚ â”‚ â”‚ star-man       â”‚ 100 â”‚115KBâ”‚ä¿®å¤bug   â”‚[åˆ ]â”‚   â”‚   â”‚
â”‚ â”‚ â”‚ md-save        â”‚  94 â”‚105KBâ”‚æ·»åŠ åŠŸèƒ½  â”‚[åˆ ]â”‚   â”‚   â”‚
â”‚ â”‚ â”‚ api-center     â”‚  43 â”‚ 52KBâ”‚æ›´æ–°æ–‡æ¡£  â”‚[åˆ ]â”‚   â”‚   â”‚
â”‚ â”‚ â”‚ ccxman         â”‚  25 â”‚ 28KBâ”‚ä¼˜åŒ–æ€§èƒ½  â”‚[åˆ ]â”‚   â”‚   â”‚
â”‚ â”‚ â”‚ ...            â”‚     â”‚     â”‚          â”‚   â”‚   â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ CacheInfoTable (ç¼“å­˜ä¿¡æ¯è¡¨æ ¼)                   â”‚   â”‚
â”‚ â”‚                                                 â”‚   â”‚
â”‚ â”‚ ğŸ’¾ ç¼“å­˜ä¿¡æ¯ (4é¡¹ç¼“å­˜, çº¦30KB)                   â”‚   â”‚
â”‚ â”‚                                                 â”‚   â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚ â”‚ â”‚ ç¼“å­˜é¡¹         â”‚ å¤§å°  â”‚ æœ€åæ›´æ–° â”‚ æ“ä½œ â”‚   â”‚   â”‚
â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚   â”‚
â”‚ â”‚ â”‚ æ›´æ–°æ—¥å¿—       â”‚ 29KB â”‚ 2å¤©å‰    â”‚ [åˆ ] â”‚   â”‚   â”‚
â”‚ â”‚ â”‚ åŠ¨æ€é…ç½®       â”‚0.5KB â”‚ 1å°æ—¶å‰  â”‚ [åˆ ] â”‚   â”‚   â”‚
â”‚ â”‚ â”‚ ç‰¹æ€§å¼€å…³       â”‚0.3KB â”‚ 1å°æ—¶å‰  â”‚ [åˆ ] â”‚   â”‚   â”‚
â”‚ â”‚ â”‚ æç¤ºå†å²       â”‚0.2KB â”‚ 1å¤©å‰    â”‚ [åˆ ] â”‚   â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç»„ä»¶è®¾è®¡

### 1. CleanHeader - é¡¶éƒ¨æ§åˆ¶åŒº

**èŒè´£ï¼š**
- æ˜¾ç¤ºæ–‡ä»¶æ€»å¤§å°
- æä¾›3ä¸ªé¢„è®¾æ¸…ç†æŒ‰é’®
- æä¾›åˆ·æ–°æŒ‰é’®

**ä»£ç ç»“æ„ï¼š**
```typescript
interface CleanHeaderProps {
  fileSize: string              // "775.1 KB"
  onPresetClean: (preset: 'conservative' | 'moderate' | 'aggressive') => void
  onRefresh: () => void
  loading: boolean
}

export function CleanHeader({ fileSize, onPresetClean, onRefresh, loading }: CleanHeaderProps) {
  return (
    <div className="clean-header">
      <div className="file-size">
        <span>ğŸ“Š æ–‡ä»¶å¤§å°: </span>
        <strong>{fileSize}</strong>
      </div>

      <div className="actions">
        <Button
          variant="success"
          onClick={() => onPresetClean('conservative')}
          disabled={loading}
        >
          ä¿å®ˆæ¸…ç†
        </Button>

        <Button
          variant="warning"
          onClick={() => onPresetClean('moderate')}
          disabled={loading}
        >
          ä¸­ç­‰æ¸…ç†
        </Button>

        <Button
          variant="danger"
          onClick={() => onPresetClean('aggressive')}
          disabled={loading}
        >
          æ¿€è¿›æ¸…ç†
        </Button>

        <Button
          variant="secondary"
          onClick={onRefresh}
          disabled={loading}
        >
          {loading ? <Spinner /> : 'åˆ·æ–°'}
        </Button>
      </div>
    </div>
  )
}
```

**æ ·å¼ï¼š**
```css
.clean-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background: #f5f5f5;
  border-radius: 8px;
  margin-bottom: 24px;
}

.file-size {
  font-size: 16px;
}

.actions {
  display: flex;
  gap: 8px;
}
```

**é¢„è®¡ä»£ç é‡ï¼š** ~50è¡Œ

---

### 2. ProjectHistoryTable - é¡¹ç›®å†å²è¡¨æ ¼

**èŒè´£ï¼š**
- æ˜¾ç¤ºæ‰€æœ‰é¡¹ç›®çš„å†å²è®°å½•
- æ¯è¡Œæ˜¾ç¤ºï¼šè·¯å¾„ã€æ¶ˆæ¯æ•°ã€å¤§å°ã€æœ€åæ¶ˆæ¯ã€åˆ é™¤æŒ‰é’®
- æ”¯æŒè·¯å¾„ç‚¹å‡»ï¼ˆæ‰“å¼€é¡¹ç›®ï¼‰
- æ”¯æŒæ’åºï¼ˆæŒ‰å¤§å°ã€æ¶ˆæ¯æ•°ï¼‰

**æ•°æ®ç»“æ„ï¼š**
```typescript
interface ProjectHistoryTableProps {
  projects: ProjectDetail[]      // æ¥è‡ª getProjectDetails()
  onDelete: (projectPath: string) => void
  loading: boolean
}

interface ProjectDetail {
  path: string                   // "/Users/xx/project/antool-mono"
  historyCount: number           // 100
  estimatedSize: number          // 120000 (å­—èŠ‚)
  lastMessage?: string           // "åˆ›å»ºæ–°ç»„ä»¶"
}
```

**ä»£ç ç»“æ„ï¼š**
```typescript
export function ProjectHistoryTable({ projects, onDelete, loading }: ProjectHistoryTableProps) {
  const [sortBy, setSortBy] = useState<'size' | 'count'>('size')

  // æ’åº
  const sorted = [...projects].sort((a, b) => {
    if (sortBy === 'size') {
      return b.estimatedSize - a.estimatedSize
    }
    return b.historyCount - a.historyCount
  })

  const handleDelete = async (path: string) => {
    const confirmed = await confirm(
      'ç¡®è®¤åˆ é™¤ï¼Ÿ',
      `å°†æ¸…ç©ºé¡¹ç›® "${shortenPath(path)}" çš„æ‰€æœ‰å†å²è®°å½•`
    )
    if (confirmed) {
      onDelete(path)
    }
  }

  return (
    <div className="project-history-table">
      <div className="table-header">
        <h3>ğŸ“ é¡¹ç›®å†å²ä¼šè¯</h3>
        <span className="count">
          {projects.length} ä¸ªé¡¹ç›®, {totalCount} æ¡è®°å½•
        </span>
      </div>

      <table>
        <thead>
          <tr>
            <th>é¡¹ç›®è·¯å¾„</th>
            <th onClick={() => setSortBy('count')} className="sortable">
              æ¶ˆæ¯æ•° {sortBy === 'count' && 'â–¼'}
            </th>
            <th onClick={() => setSortBy('size')} className="sortable">
              å¤§å° {sortBy === 'size' && 'â–¼'}
            </th>
            <th>æœ€åæ¶ˆæ¯</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          {sorted.map(project => (
            <tr key={project.path}>
              <td>
                <span
                  className="path-link"
                  onClick={() => openProject(project.path)}
                  title={project.path}
                >
                  {shortenPath(project.path)}
                </span>
              </td>
              <td>{project.historyCount}</td>
              <td>{formatBytes(project.estimatedSize)}</td>
              <td className="last-message">
                {truncate(project.lastMessage, 30)}
              </td>
              <td>
                <Button
                  size="sm"
                  variant="danger"
                  onClick={() => handleDelete(project.path)}
                  disabled={loading}
                >
                  åˆ é™¤
                </Button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  )
}

// è¾…åŠ©å‡½æ•°
function shortenPath(path: string): string {
  const parts = path.split('/')
  return parts[parts.length - 1] || path
}

function truncate(text: string | undefined, maxLen: number): string {
  if (!text) return '-'
  return text.length > maxLen ? text.slice(0, maxLen) + '...' : text
}

function openProject(path: string) {
  window.electronAPI.shell.openPath(path)
}
```

**æ ·å¼è¦ç‚¹ï¼š**
```css
.project-history-table {
  background: white;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 24px;
}

.path-link {
  color: #3b82f6;
  cursor: pointer;
  text-decoration: underline;
}

.path-link:hover {
  color: #2563eb;
}

.sortable {
  cursor: pointer;
  user-select: none;
}

.sortable:hover {
  background: #f5f5f5;
}

.last-message {
  color: #666;
  font-size: 14px;
}
```

**é¢„è®¡ä»£ç é‡ï¼š** ~200è¡Œ

---

### 3. CacheInfoTable - ç¼“å­˜ä¿¡æ¯è¡¨æ ¼

**èŒè´£ï¼š**
- æ˜¾ç¤ºæ‰€æœ‰ç¼“å­˜é¡¹
- æ¯è¡Œæ˜¾ç¤ºï¼šç¼“å­˜åç§°ã€å¤§å°ã€æœ€åæ›´æ–°ã€åˆ é™¤æŒ‰é’®
- æ”¯æŒç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼ˆ1å°æ—¶å‰ã€2å¤©å‰ï¼‰

**æ•°æ®ç»“æ„ï¼š**
```typescript
interface CacheInfoTableProps {
  caches: CacheDetail[]          // æ¥è‡ª getCacheDetails()
  onDelete: (cacheKey: string) => void
  loading: boolean
}

interface CacheDetail {
  key: string                    // 'cachedChangelog'
  name: string                   // 'æ›´æ–°æ—¥å¿—'
  size: number                   // 29687
  sizeFormatted: string          // '29 KB'
  lastUpdated?: number           // æ—¶é—´æˆ³
}
```

**ä»£ç ç»“æ„ï¼š**
```typescript
export function CacheInfoTable({ caches, onDelete, loading }: CacheInfoTableProps) {
  const handleDelete = async (cache: CacheDetail) => {
    const confirmed = await confirm(
      'ç¡®è®¤åˆ é™¤ï¼Ÿ',
      `å°†åˆ é™¤ç¼“å­˜é¡¹ "${cache.name}"`
    )
    if (confirmed) {
      onDelete(cache.key)
    }
  }

  const totalSize = caches.reduce((sum, c) => sum + c.size, 0)

  return (
    <div className="cache-info-table">
      <div className="table-header">
        <h3>ğŸ’¾ ç¼“å­˜ä¿¡æ¯</h3>
        <span className="count">
          {caches.length} é¡¹ç¼“å­˜, çº¦ {formatBytes(totalSize)}
        </span>
      </div>

      <table>
        <thead>
          <tr>
            <th>ç¼“å­˜é¡¹</th>
            <th>å¤§å°</th>
            <th>æœ€åæ›´æ–°</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          {caches.map(cache => (
            <tr key={cache.key}>
              <td>{cache.name}</td>
              <td>{cache.sizeFormatted}</td>
              <td>
                {cache.lastUpdated
                  ? formatRelativeTime(cache.lastUpdated)
                  : '-'}
              </td>
              <td>
                <Button
                  size="sm"
                  variant="danger"
                  onClick={() => handleDelete(cache)}
                  disabled={loading}
                >
                  åˆ é™¤
                </Button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  )
}

// è¾…åŠ©å‡½æ•°
function formatRelativeTime(timestamp: number): string {
  const now = Date.now()
  const diff = now - timestamp
  const seconds = Math.floor(diff / 1000)
  const minutes = Math.floor(seconds / 60)
  const hours = Math.floor(minutes / 60)
  const days = Math.floor(hours / 24)

  if (days > 0) return `${days}å¤©å‰`
  if (hours > 0) return `${hours}å°æ—¶å‰`
  if (minutes > 0) return `${minutes}åˆ†é’Ÿå‰`
  return 'åˆšåˆš'
}
```

**é¢„è®¡ä»£ç é‡ï¼š** ~150è¡Œ

---

## CleanPage - ä¸»é¡µé¢

**èŒè´£ï¼š**
- ç®¡ç†å…¨å±€çŠ¶æ€
- åè°ƒ3ä¸ªç»„ä»¶
- è°ƒç”¨ Electron IPC

**ä»£ç ç»“æ„ï¼š**
```typescript
export function CleanPage() {
  const [fileSize, setFileSize] = useState('')
  const [projects, setProjects] = useState<ProjectDetail[]>([])
  const [caches, setCaches] = useState<CacheDetail[]>([])
  const [loading, setLoading] = useState(false)

  // åˆå§‹åŠ è½½
  useEffect(() => {
    loadData()
  }, [])

  // åŠ è½½æ‰€æœ‰æ•°æ®
  const loadData = async () => {
    setLoading(true)
    try {
      // å¹¶è¡ŒåŠ è½½
      const [analysisRes, projectsRes, cachesRes] = await Promise.all([
        window.electronAPI.clean.analyze(),
        window.electronAPI.clean.getProjects(),
        window.electronAPI.clean.getCaches(),
      ])

      if (analysisRes.success) {
        setFileSize(analysisRes.data.fileSizeFormatted)
      }
      if (projectsRes.success) {
        setProjects(projectsRes.data)
      }
      if (cachesRes.success) {
        setCaches(cachesRes.data)
      }
    } catch (error) {
      showError(error.message)
    } finally {
      setLoading(false)
    }
  }

  // é¢„è®¾æ¸…ç†
  const handlePresetClean = async (preset: string) => {
    const confirmed = await confirm(
      'ç¡®è®¤æ¸…ç†ï¼Ÿ',
      getPresetDescription(preset)
    )
    if (!confirmed) return

    setLoading(true)
    try {
      const result = await window.electronAPI.clean.executePreset(preset)
      if (result.success) {
        showSuccess(`æ¸…ç†å®Œæˆï¼ŒèŠ‚çœ ${formatBytes(result.data.saved)}`)
        await loadData() // é‡æ–°åŠ è½½
      }
    } catch (error) {
      showError(error.message)
    } finally {
      setLoading(false)
    }
  }

  // åˆ é™¤å•ä¸ªé¡¹ç›®
  const handleDeleteProject = async (path: string) => {
    setLoading(true)
    try {
      const result = await window.electronAPI.clean.deleteProject(path)
      if (result.success) {
        showSuccess('å·²åˆ é™¤é¡¹ç›®å†å²')
        await loadData()
      }
    } catch (error) {
      showError(error.message)
    } finally {
      setLoading(false)
    }
  }

  // åˆ é™¤å•ä¸ªç¼“å­˜
  const handleDeleteCache = async (key: string) => {
    setLoading(true)
    try {
      const result = await window.electronAPI.clean.deleteCache(key)
      if (result.success) {
        showSuccess('å·²åˆ é™¤ç¼“å­˜')
        await loadData()
      }
    } catch (error) {
      showError(error.message)
    } finally {
      setLoading(false)
    }
  }

  return (
    <div className="clean-page">
      <h1>æ¸…ç†é…ç½®</h1>

      <CleanHeader
        fileSize={fileSize}
        onPresetClean={handlePresetClean}
        onRefresh={loadData}
        loading={loading}
      />

      <ProjectHistoryTable
        projects={projects}
        onDelete={handleDeleteProject}
        loading={loading}
      />

      <CacheInfoTable
        caches={caches}
        onDelete={handleDeleteCache}
        loading={loading}
      />
    </div>
  )
}

function getPresetDescription(preset: string): string {
  switch (preset) {
    case 'conservative':
      return 'ä¿ç•™æœ€è¿‘10æ¡è®°å½•ï¼Œæ¸…ç†ç¼“å­˜æ•°æ®'
    case 'moderate':
      return 'ä¿ç•™æœ€è¿‘5æ¡è®°å½•ï¼Œæ¸…ç†ç¼“å­˜å’Œç»Ÿè®¡'
    case 'aggressive':
      return 'æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å’Œç¼“å­˜'
    default:
      return ''
  }
}
```

---

## Electron IPC æ¥å£

### Main Process (main.ts)

```typescript
import { ipcMain } from 'electron'
import {
  analyzeClaudeJson,
  getProjectDetails,
  getCacheDetails,
  deleteProjectHistory,
  deleteCacheItem,
  cleanClaudeJson,
  CleanPresets,
} from '@ccman/core'

/**
 * åˆ†æé…ç½®æ–‡ä»¶
 */
ipcMain.handle('clean-analyze', async () => {
  try {
    const result = analyzeClaudeJson()
    return { success: true, data: result }
  } catch (error) {
    return { success: false, error: (error as Error).message }
  }
})

/**
 * è·å–é¡¹ç›®åˆ—è¡¨
 */
ipcMain.handle('clean-get-projects', async () => {
  try {
    const result = getProjectDetails()
    return { success: true, data: result }
  } catch (error) {
    return { success: false, error: (error as Error).message }
  }
})

/**
 * è·å–ç¼“å­˜åˆ—è¡¨
 */
ipcMain.handle('clean-get-caches', async () => {
  try {
    const result = getCacheDetails()
    return { success: true, data: result }
  } catch (error) {
    return { success: false, error: (error as Error).message }
  }
})

/**
 * åˆ é™¤å•ä¸ªé¡¹ç›®
 */
ipcMain.handle('clean-delete-project', async (event, projectPath: string) => {
  try {
    deleteProjectHistory(projectPath)
    return { success: true }
  } catch (error) {
    return { success: false, error: (error as Error).message }
  }
})

/**
 * åˆ é™¤å•ä¸ªç¼“å­˜
 */
ipcMain.handle('clean-delete-cache', async (event, cacheKey: string) => {
  try {
    deleteCacheItem(cacheKey)
    return { success: true }
  } catch (error) {
    return { success: false, error: (error as Error).message }
  }
})

/**
 * æ‰§è¡Œé¢„è®¾æ¸…ç†
 */
ipcMain.handle('clean-execute-preset', async (event, preset: string) => {
  try {
    let options
    if (preset === 'conservative') {
      options = CleanPresets.conservative()
    } else if (preset === 'moderate') {
      options = CleanPresets.moderate()
    } else if (preset === 'aggressive') {
      options = CleanPresets.aggressive()
    } else {
      throw new Error('æœªçŸ¥çš„é¢„è®¾æ–¹æ¡ˆ')
    }

    const result = cleanClaudeJson(options)
    return { success: true, data: result }
  } catch (error) {
    return { success: false, error: (error as Error).message }
  }
})
```

### Preload Script (preload.ts)

```typescript
import { contextBridge, ipcRenderer } from 'electron'

contextBridge.exposeInMainWorld('electronAPI', {
  // ... ç°æœ‰ API

  clean: {
    analyze: () => ipcRenderer.invoke('clean-analyze'),
    getProjects: () => ipcRenderer.invoke('clean-get-projects'),
    getCaches: () => ipcRenderer.invoke('clean-get-caches'),
    deleteProject: (path: string) => ipcRenderer.invoke('clean-delete-project', path),
    deleteCache: (key: string) => ipcRenderer.invoke('clean-delete-cache', key),
    executePreset: (preset: string) => ipcRenderer.invoke('clean-execute-preset', preset),
  },

  shell: {
    openPath: (path: string) => ipcRenderer.invoke('shell-open-path', path),
  },
})
```

---

## ä»£ç é‡ç»Ÿè®¡

| ç»„ä»¶/æ¨¡å— | ä»£ç é‡ | è¯´æ˜ |
|-----------|--------|------|
| CleanHeader | ~50è¡Œ | é¡¶éƒ¨æ§åˆ¶åŒº |
| ProjectHistoryTable | ~200è¡Œ | é¡¹ç›®è¡¨æ ¼ |
| CacheInfoTable | ~150è¡Œ | ç¼“å­˜è¡¨æ ¼ |
| CleanPage | ~100è¡Œ | ä¸»é¡µé¢ |
| IPC Handlers (main) | ~80è¡Œ | ä¸»è¿›ç¨‹å¤„ç† |
| Preload | ~20è¡Œ | é¢„åŠ è½½è„šæœ¬ |
| **æ€»è®¡** | **~600è¡Œ** | |

æ¯” V1 ç‰ˆæœ¬ï¼ˆ~1200è¡Œï¼‰å‡å°‘äº†ä¸€åŠï¼

---

## å¯¹æ¯”åˆ†æ

### V1 è®¾è®¡ï¼ˆå¤æ‚ç‰ˆï¼‰
- âŒ 5ä¸ªç»„ä»¶ï¼ˆCleanAnalysisCard, CleanVisualization, CleanConfigForm, CleanResultModal, BackupManagerï¼‰
- âŒ éœ€è¦å›¾è¡¨åº“ï¼ˆrechartsï¼‰
- âŒ å¤æ‚çš„è¡¨å•çŠ¶æ€ç®¡ç†
- âŒ è¿‡å¤šçš„å¼¹çª—äº¤äº’
- âŒ ~1200è¡Œä»£ç 

### V2 è®¾è®¡ï¼ˆç®€åŒ–ç‰ˆï¼‰
- âœ… 3ä¸ªç»„ä»¶ï¼ˆCleanHeader, ProjectHistoryTable, CacheInfoTableï¼‰
- âœ… ä¸éœ€è¦å›¾è¡¨åº“
- âœ… ç®€å•çš„åˆ—è¡¨å±•ç¤º
- âœ… ç›´æ¥çš„åˆ é™¤æ“ä½œ
- âœ… ~600è¡Œä»£ç 

---

## ç”¨æˆ·ä½“éªŒä¼˜åŠ¿

### 1. æ›´ç›´è§‚
- æ‰€æœ‰æ•°æ®ä¸€ç›®äº†ç„¶
- ä¸éœ€è¦åˆ‡æ¢è§†å›¾
- ä¸éœ€è¦ç†è§£å›¾è¡¨

### 2. æ›´çµæ´»
- å¯ä»¥é€ä¸ªåˆ é™¤é¡¹ç›®
- å¯ä»¥é€‰æ‹©æ€§æ¸…ç†ç¼“å­˜
- å¯ä»¥å¿«é€Ÿæ‰¹é‡æ¸…ç†ï¼ˆé¢„è®¾æŒ‰é’®ï¼‰

### 3. æ›´å¿«é€Ÿ
- åŠ è½½æ›´å¿«ï¼ˆä¸éœ€è¦æ¸²æŸ“å›¾è¡¨ï¼‰
- æ“ä½œæ›´å¿«ï¼ˆä¸€é”®åˆ é™¤ï¼‰
- åé¦ˆæ›´å¿«ï¼ˆå³æ—¶åˆ·æ–°ï¼‰

---

## å®ç°è®¡åˆ’

### Phase 1: åŸºç¡€åŠŸèƒ½ï¼ˆ2-3å¤©ï¼‰
- [x] Core æ‰©å±•åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰
- [ ] IPC æ¥å£å®ç°
- [ ] CleanHeader ç»„ä»¶
- [ ] ProjectHistoryTable ç»„ä»¶
- [ ] CacheInfoTable ç»„ä»¶
- [ ] CleanPage é¡µé¢é›†æˆ

### Phase 2: ä¼˜åŒ–ä½“éªŒï¼ˆ1-2å¤©ï¼‰
- [ ] æ’åºåŠŸèƒ½
- [ ] è·¯å¾„ç‚¹å‡»æ‰“å¼€
- [ ] ç›¸å¯¹æ—¶é—´æ˜¾ç¤º
- [ ] ç¡®è®¤å¯¹è¯æ¡†
- [ ] æˆåŠŸ/å¤±è´¥é€šçŸ¥

### Phase 3: å®Œå–„ç»†èŠ‚ï¼ˆ1å¤©ï¼‰
- [ ] ç©ºçŠ¶æ€å¤„ç†
- [ ] é”™è¯¯å¤„ç†
- [ ] åŠ è½½çŠ¶æ€ä¼˜åŒ–
- [ ] æ ·å¼ç¾åŒ–

---

## æŠ€æœ¯æ ˆ

### å¿…é¡»
- Reactï¼ˆå·²æœ‰ï¼‰
- lucide-reactï¼ˆå›¾æ ‡ï¼Œå·²æœ‰ï¼‰

### ä¸éœ€è¦
- âŒ rechartsï¼ˆä¸éœ€è¦å›¾è¡¨ï¼‰
- âŒ Zustand/Reduxï¼ˆç®€å•çŠ¶æ€ï¼‰
- âŒ å…¶ä»–å›¾æ ‡åº“ï¼ˆç»Ÿä¸€ lucide-reactï¼‰

---

## ç¬¦åˆé¡¹ç›®è§„èŒƒæ£€æŸ¥

- âœ… **ç®€æ´è‡³ä¸Š**ï¼š3ä¸ªç»„ä»¶ï¼Œæ¯ä¸ª < 200è¡Œ
- âœ… **æ•°æ®ç»“æ„ä¼˜å…ˆ**ï¼šCore æä¾›æ‰€æœ‰æ•°æ®ï¼ŒUI åªå±•ç¤º
- âœ… **é›¶ç ´åæ€§**ï¼šæ¯ä¸ªæ“ä½œéƒ½æœ‰å¤‡ä»½
- âœ… **å®ç”¨ä¸»ä¹‰**ï¼šè§£å†³å®é™…é—®é¢˜ï¼Œä¸è¿‡åº¦è®¾è®¡
- âœ… **é›¶èƒ¶æ°´å±‚**ï¼šMain Process ç›´æ¥è°ƒç”¨ Core

---

## æ€»ç»“

**V2 è®¾è®¡çš„æ ¸å¿ƒæ”¹è¿›ï¼š**

1. **å»æ‰å¤æ‚å›¾è¡¨** â†’ ç®€å•åˆ—è¡¨
2. **å»æ‰é…ç½®è¡¨å•** â†’ ç›´æ¥åˆ é™¤æŒ‰é’®
3. **å»æ‰ç»“æœå¼¹çª—** â†’ é€šçŸ¥æç¤º
4. **å»æ‰å¤‡ä»½ç®¡ç†** â†’ è‡ªåŠ¨å¤‡ä»½ï¼ˆä¸éœ€è¦UIï¼‰

**ç»“æœï¼š**
- ä»£ç é‡å‡åŠï¼ˆ600è¡Œ vs 1200è¡Œï¼‰
- åŠŸèƒ½æ›´å¼ºå¤§ï¼ˆç»†ç²’åº¦æ§åˆ¶ï¼‰
- ç”¨æˆ·ä½“éªŒæ›´å¥½ï¼ˆç›´è§‚ã€å¿«é€Ÿï¼‰
- æ›´ç¬¦åˆé¡¹ç›®è§„èŒƒï¼ˆç®€æ´è‡³ä¸Šï¼‰
