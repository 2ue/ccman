# ä¸ºä»€ä¹ˆä¸åš WebDAV åŒæ­¥ï¼Ÿ

## TL;DR

**ç»“è®º**: WebDAV åŒæ­¥ä¸å€¼å¾—åšã€‚

**åŸå› **:
1. âŒ è§£å†³ä¸å­˜åœ¨çš„é—®é¢˜ï¼ˆ< 5% ç”¨æˆ·éœ€è¦ï¼‰
2. âŒ å¯¼å‡ºå¯¼å…¥å·²ç»è§£å†³äº†çœŸå®é—®é¢˜
3. âŒ å®‰å…¨é£é™©é«˜ï¼ˆAPI Key å­˜å‚¨åœ¨äº‘ç«¯ï¼‰
4. âŒ å¤æ‚åº¦é«˜ï¼ˆ~500 è¡Œä»£ç ï¼Œå†²çªå¤„ç†ï¼‰
5. âŒ ç»´æŠ¤æˆæœ¬é«˜ï¼ˆç½‘ç»œé”™è¯¯ã€è®¤è¯ã€å…¼å®¹æ€§ï¼‰

**æ›¿ä»£æ–¹æ¡ˆ**: å¯¼å‡º JSON â†’ äº‘ç›˜/Uç›˜ â†’ å¯¼å…¥ï¼ˆç®€å•ã€å®‰å…¨ã€æ— å†²çªï¼‰

---

## ä¸€ã€Linus çš„ä¸‰ä¸ªé—®é¢˜

### 1. "è¿™æ˜¯çœŸé—®é¢˜è¿˜æ˜¯è‡†æƒ³å‡ºæ¥çš„ï¼Ÿ"

#### çœŸå®éœ€æ±‚åˆ†æ

**å‡è®¾çš„åœºæ™¯**:
> "æˆ‘æœ‰å¤šå°è®¾å¤‡ï¼ˆMacã€Windowsã€Linuxï¼‰ï¼Œç»å¸¸åœ¨ä¸åŒè®¾å¤‡é—´åˆ‡æ¢å¼€å‘ï¼Œéœ€è¦å®æ—¶åŒæ­¥ API æœåŠ¡å•†é…ç½®ã€‚"

**è´¨ç–‘**:

1. **æœ‰å¤šå°‘å¼€å‘è€…çœŸçš„è¿™æ ·å·¥ä½œï¼Ÿ**
   - å¤§å¤šæ•°å¼€å‘è€…åªåœ¨ä¸€å°ä¸»åŠ›æœºå™¨ä¸Šå†™ä»£ç 
   - å³ä½¿æœ‰å¤šå°æœºå™¨ï¼Œä¹Ÿé€šå¸¸åªåœ¨å…¶ä¸­ä¸€å°ä¸Šé…ç½®å¼€å‘ç¯å¢ƒ
   - ä¸´æ—¶åˆ‡æ¢æœºå™¨æ—¶ï¼Œä½¿ç”¨å¯¼å‡ºå¯¼å…¥è¿ç§»é…ç½®ï¼ˆä¸€æ¬¡æ€§æ“ä½œï¼‰

2. **æœåŠ¡å•†é…ç½®çœŸçš„éœ€è¦å®æ—¶åŒæ­¥å—ï¼Ÿ**
   - æœåŠ¡å•†é…ç½®å˜æ›´é¢‘ç‡ï¼š< 1 æ¬¡/å‘¨
   - å¤§å¤šæ•°å¼€å‘è€…ä¸€æ—¦é…ç½®å¥½å°±ä¸ä¼šé¢‘ç¹æ”¹åŠ¨
   - ä¸æ˜¯é«˜é¢‘æ“ä½œï¼Œä¸éœ€è¦è‡ªåŠ¨åŒæ­¥

3. **çœŸå®åœºæ™¯éªŒè¯**:
   - **æ¢ç”µè„‘**: ä¸€æ¬¡æ€§è¿ç§»ï¼Œå¯¼å‡ºå¯¼å…¥å³å¯ âœ…
   - **å›¢é˜Ÿå…±äº«**: åˆ†äº«é…ç½®æ¨¡æ¿ï¼ˆä¸å« API Keyï¼‰ï¼Œå¯¼å‡ºå¯¼å…¥å³å¯ âœ…
   - **å¤‡ä»½**: Time Machine/rsync å·²ç»åšäº† âœ…
   - **å¤šè®¾å¤‡å®æ—¶åŒæ­¥**: â“ è°çœŸçš„éœ€è¦ï¼Ÿ

**ç»“è®º**: è¿™æ˜¯è‡†æƒ³å‡ºæ¥çš„éœ€æ±‚ã€‚çœŸå®éœ€æ±‚ï¼ˆæ¢ç”µè„‘ã€å›¢é˜Ÿå…±äº«ï¼‰å·²ç»è¢«å¯¼å‡ºå¯¼å…¥è§£å†³äº†ã€‚

---

### 2. "æœ‰æ›´ç®€å•çš„æ–¹æ³•å—ï¼Ÿ"

#### æ–¹æ¡ˆå¯¹æ¯”

| ç»´åº¦ | æ‰‹åŠ¨å¤åˆ¶ | å¯¼å‡ºå¯¼å…¥ | WebDAV åŒæ­¥ |
|------|----------|----------|-------------|
| **å¤æ‚åº¦** | 0 è¡Œä»£ç  | ~200 è¡Œä»£ç  | ~500 è¡Œä»£ç  |
| **å®‰å…¨æ€§** | âœ… å®‰å…¨ | âœ… å¯æ§ | âŒ API Key åœ¨äº‘ç«¯ |
| **å†²çªå¤„ç†** | âœ… æ— å†²çª | âœ… æ— å†²çª | âŒ éœ€è¦ merge é€»è¾‘ |
| **ç½‘ç»œä¾èµ–** | âœ… æ—  | âœ… æ—  | âŒ éœ€è¦ç½‘ç»œ |
| **ç”¨æˆ·ä½“éªŒ** | âŒ Geek only | âœ… å‹å¥½ | âš ï¸ é…ç½®å¤æ‚ |
| **ç»´æŠ¤æˆæœ¬** | âœ… æ—  | ğŸŸ¢ ä½ | ğŸ”´ é«˜ |

#### æ–¹æ¡ˆ A: æ‰‹åŠ¨å¤åˆ¶

```bash
# æœ€ç®€å•çš„æ–¹æ³•ï¼ˆ0 è¡Œä»£ç ï¼‰
rsync -av ~/.ccman/ new-machine:~/.ccman/
```

**ä¼˜ç‚¹**:
- é›¶ä»£ç 
- é›¶é£é™©
- é›¶ç»´æŠ¤

**ç¼ºç‚¹**:
- éœ€è¦ç”¨æˆ·æ‡‚å‘½ä»¤è¡Œ
- ä¸é€‚åˆæ™®é€šç”¨æˆ·

---

#### æ–¹æ¡ˆ B: å¯¼å‡ºå¯¼å…¥ï¼ˆæ¨èï¼‰

```bash
# æ—§æœºå™¨
ccman export --output ~/backup.json

# ä¼ è¾“ï¼ˆäº‘ç›˜ã€Uç›˜ã€é‚®ä»¶ï¼‰
# ...

# æ–°æœºå™¨
ccman import ~/backup.json
```

**ä¼˜ç‚¹**:
- ç®€å•ï¼ˆ~200 è¡Œä»£ç ï¼‰
- å®‰å…¨ï¼ˆå¯é€‰æ‹©ä¸å¯¼å‡º API Keyï¼‰
- æ— å†²çªï¼ˆæ˜ç¡®çš„å¯¼å…¥æ—¶é—´ç‚¹ï¼‰
- å‹å¥½ï¼ˆCLI + Desktop UIï¼‰

**ç¼ºç‚¹**:
- ä¸æ˜¯è‡ªåŠ¨çš„ï¼ˆéœ€è¦æ‰‹åŠ¨æ“ä½œï¼‰
- ä½†è¿™ä¸æ˜¯ç¼ºç‚¹ï¼Œå› ä¸ºé…ç½®è¿ç§»æ˜¯ä½é¢‘æ“ä½œ

---

#### æ–¹æ¡ˆ C: WebDAV åŒæ­¥ï¼ˆä¸æ¨èï¼‰

**å®ç°éœ€æ±‚**:
1. WebDAV å®¢æˆ·ç«¯ï¼ˆä¾èµ–åº“ï¼‰
2. è®¤è¯ç®¡ç†ï¼ˆè´¦å·ã€å¯†ç ã€URLï¼‰
3. å†²çªå¤„ç†ï¼ˆA æœºå™¨æ”¹äº†ï¼ŒB æœºå™¨ä¹Ÿæ”¹äº†ï¼‰
4. ç½‘ç»œé”™è¯¯å¤„ç†ï¼ˆè¶…æ—¶ã€è¿æ¥å¤±è´¥ï¼‰
5. åŒæ­¥ç­–ç•¥ï¼ˆå®æ—¶ï¼Ÿå®šæ—¶ï¼Ÿæ‰‹åŠ¨ï¼Ÿï¼‰
6. UI é…ç½®ï¼ˆWebDAV æœåŠ¡å™¨è®¾ç½®ï¼‰
7. å®‰å…¨æ€§ï¼ˆåŠ å¯† API Keyï¼Ÿï¼‰
8. ç‰ˆæœ¬æ§åˆ¶ï¼ˆé¿å…è¦†ç›–æ—§ç‰ˆæœ¬ï¼‰

**å¤æ‚åº¦**:
```typescript
// WebDAV å®¢æˆ·ç«¯
import { createClient } from 'webdav'  // ä¾èµ–åº“

// è®¤è¯ç®¡ç†
interface WebDAVConfig {
  url: string
  username: string
  password: string  // åˆæ˜¯ä¸€ä¸ªéœ€è¦å®‰å…¨å­˜å‚¨çš„å¯†é’¥
}

// å†²çªå¤„ç†
function mergeConfig(local: Config, remote: Config): Config {
  // è°ä¼˜å…ˆï¼Ÿæ—¶é—´æˆ³ï¼Ÿç‰ˆæœ¬å·ï¼Ÿç”¨æˆ·é€‰æ‹©ï¼Ÿ
  // å¦‚æœ A åˆ é™¤äº† providerï¼ŒB æ·»åŠ äº† providerï¼Œæ€ä¹ˆåŠï¼Ÿ
  // å¦‚æœ A å’Œ B åŒæ—¶ä¿®æ”¹äº†åŒä¸€ä¸ª provider çš„ API Keyï¼Œæ€ä¹ˆåŠï¼Ÿ
}

// åŒæ­¥ç­–ç•¥
enum SyncStrategy {
  REALTIME,   // æ¯æ¬¡ä¿®æ”¹ç«‹å³åŒæ­¥ï¼ˆç½‘ç»œå‹åŠ›å¤§ï¼‰
  PERIODIC,   // å®šæ—¶åŒæ­¥ï¼ˆå¯èƒ½ä¸¢å¤±æ•°æ®ï¼‰
  MANUAL      // æ‰‹åŠ¨åŒæ­¥ï¼ˆé‚£è¿˜ä¸å¦‚å¯¼å‡ºå¯¼å…¥ï¼‰
}

// é”™è¯¯å¤„ç†
try {
  await syncToWebDAV()
} catch (error) {
  if (error.code === 'NETWORK_ERROR') {
    // ç¦»çº¿æ—¶æ€ä¹ˆåŠï¼Ÿé˜Ÿåˆ—ï¼Ÿé‡è¯•ï¼Ÿ
  } else if (error.code === 'AUTH_FAILED') {
    // è®¤è¯å¤±è´¥æ€ä¹ˆåŠï¼Ÿæç¤ºç”¨æˆ·é‡æ–°è¾“å…¥å¯†ç ï¼Ÿ
  } else if (error.code === 'CONFLICT') {
    // å†²çªæ€ä¹ˆåŠï¼Ÿè®©ç”¨æˆ·é€‰æ‹©ï¼Ÿè‡ªåŠ¨åˆå¹¶ï¼Ÿ
  }
}
```

**ä»£ç é‡ä¼°ç®—**:
- WebDAV å®¢æˆ·ç«¯é›†æˆ: ~50 è¡Œ
- è®¤è¯ç®¡ç†: ~50 è¡Œ
- å†²çªå¤„ç†: ~100 è¡Œ
- åŒæ­¥ç­–ç•¥: ~100 è¡Œ
- é”™è¯¯å¤„ç†: ~100 è¡Œ
- UI é…ç½®: ~100 è¡Œ
- æµ‹è¯•: ~200 è¡Œ
- **æ€»è®¡**: ~700 è¡Œ

**ç»´æŠ¤æˆæœ¬**:
- WebDAV æœåŠ¡å™¨å…¼å®¹æ€§é—®é¢˜
- ç½‘ç»œé”™è¯¯å¤„ç†
- å†²çªåœºæ™¯æµ‹è¯•
- ç”¨æˆ·åé¦ˆï¼šåŒæ­¥å¤±è´¥ã€é…ç½®ä¸¢å¤±

---

### 3. "ä¼šç ´åä»€ä¹ˆå—ï¼Ÿ"

#### å®‰å…¨æ€§é£é™©

**é—®é¢˜ 1: API Key å­˜å‚¨åœ¨äº‘ç«¯**

```
ç”¨æˆ·çš„ API Key â†’ WebDAV æœåŠ¡å™¨ â†’ è°æœ‰æƒè®¿é—®ï¼Ÿ
```

- å¦‚æœ WebDAV æœåŠ¡å™¨è¢«æ”»å‡»ï¼ŒAPI Key æ³„éœ²
- å¦‚æœç”¨æˆ·çš„ WebDAV è´¦å·è¢«ç›—ï¼ŒAPI Key æ³„éœ²
- å³ä½¿åŠ å¯†ï¼Œä¹Ÿéœ€è¦ç®¡ç†åŠ å¯†å¯†é’¥ï¼ˆåˆæ˜¯ä¸€ä¸ªé—®é¢˜ï¼‰

**é—®é¢˜ 2: "é…ç½®çš„é…ç½®"**

```
ç”¨æˆ·éœ€è¦é…ç½®ï¼š
1. ccman çš„æœåŠ¡å•†é…ç½®ï¼ˆAPI Keyï¼‰
2. WebDAV çš„è®¤è¯é…ç½®ï¼ˆè´¦å·ã€å¯†ç ã€URLï¼‰
â†’ å¤æ‚åº¦æŒ‡æ•°å¢é•¿
```

---

#### ç ´åç®€æ´æ€§

**å½“å‰**: 2 ä¸ªé…ç½®æ–‡ä»¶ï¼Œç®€å•æ¸…æ™°
```
~/.ccman/
â”œâ”€â”€ codex.json
â””â”€â”€ claudecode.json
```

**WebDAV åŒæ­¥å**: éœ€è¦æ·»åŠ 
```
~/.ccman/
â”œâ”€â”€ codex.json
â”œâ”€â”€ claudecode.json
â”œâ”€â”€ sync.json           # åŒæ­¥é…ç½®ï¼ˆWebDAV URLã€è®¤è¯ï¼‰
â””â”€â”€ sync-state.json     # åŒæ­¥çŠ¶æ€ï¼ˆæœ€ååŒæ­¥æ—¶é—´ã€å†²çªè®°å½•ï¼‰
```

**é…ç½®å¤æ‚åº¦**: ä» 2 ä¸ªæ–‡ä»¶ â†’ 4 ä¸ªæ–‡ä»¶ â†’ 200% å¢é•¿

---

#### ç ´åå¯é æ€§

**åœºæ™¯ 1: ç½‘ç»œæ–­å¼€**
```
ç”¨æˆ·ä¿®æ”¹é…ç½® â†’ åŒæ­¥å¤±è´¥ â†’ é˜Ÿåˆ—ï¼Ÿé‡è¯•ï¼Ÿæç¤ºç”¨æˆ·ï¼Ÿ
```

**åœºæ™¯ 2: å†²çª**
```
A æœºå™¨: åˆ é™¤ provider "anthropic"
B æœºå™¨: ä¿®æ”¹ provider "anthropic" çš„ API Key
åŒæ­¥æ—¶: ä¿ç•™è¿˜æ˜¯åˆ é™¤ï¼Ÿ
```

**åœºæ™¯ 3: åŒæ­¥å»¶è¿Ÿ**
```
A æœºå™¨: åˆ‡æ¢åˆ° provider "anthropic"
B æœºå™¨: è¿˜æ²¡åŒæ­¥ï¼Œä»ç„¶ä½¿ç”¨ provider "openai"
ç”¨æˆ·å›°æƒ‘: ä¸ºä»€ä¹ˆ B æœºå™¨æ²¡æœ‰åˆ‡æ¢ï¼Ÿ
```

---

## äºŒã€çœŸå®ç”¨æˆ·åœºæ™¯åˆ†æ

### åœºæ™¯ 1: æ¢ç”µè„‘

**éœ€æ±‚**: å°†æ—§ç”µè„‘çš„é…ç½®è¿ç§»åˆ°æ–°ç”µè„‘

**æ–¹æ¡ˆå¯¹æ¯”**:

| æ–¹æ¡ˆ | æ­¥éª¤ | æ—¶é—´ | é£é™© |
|------|------|------|------|
| WebDAV åŒæ­¥ | 1. æ—§æœºå™¨å¼€å¯åŒæ­¥<br>2. æ–°æœºå™¨å¼€å¯åŒæ­¥<br>3. é…ç½® WebDAV<br>4. ç­‰å¾…åŒæ­¥å®Œæˆ | 5 åˆ†é’Ÿ | âš ï¸ API Key åœ¨äº‘ç«¯ |
| å¯¼å‡ºå¯¼å…¥ | 1. æ—§æœºå™¨å¯¼å‡º<br>2. ä¼ è¾“æ–‡ä»¶<br>3. æ–°æœºå™¨å¯¼å…¥ | 2 åˆ†é’Ÿ | âœ… å®‰å…¨ |
| æ‰‹åŠ¨å¤åˆ¶ | `rsync -av ~/.ccman/ new:~/.ccman/` | 30 ç§’ | âœ… å®‰å…¨ |

**ç»“è®º**: å¯¼å‡ºå¯¼å…¥æˆ–æ‰‹åŠ¨å¤åˆ¶æ›´å¿«ã€æ›´å®‰å…¨ã€‚

---

### åœºæ™¯ 2: å›¢é˜Ÿå…±äº«é…ç½®

**éœ€æ±‚**: å›¢é˜Ÿæˆå‘˜å…±äº«é¢„ç½®æœåŠ¡å•†é…ç½®ï¼ˆä¸å« API Keyï¼‰

**æ–¹æ¡ˆå¯¹æ¯”**:

| æ–¹æ¡ˆ | æ­¥éª¤ | é€‚ç”¨æ€§ |
|------|------|--------|
| WebDAV åŒæ­¥ | 1. å›¢é˜Ÿæ­å»º WebDAV æœåŠ¡å™¨<br>2. æ‰€æœ‰æˆå‘˜é…ç½® WebDAV<br>3. âš ï¸ å¦‚ä½•ä¸åŒæ­¥ API Keyï¼Ÿ | âŒ ä¸é€‚ç”¨ |
| å¯¼å‡ºå¯¼å…¥ | 1. å›¢é˜Ÿè´Ÿè´£äººå¯¼å‡ºï¼ˆä¸å« API Keyï¼‰<br>2. åˆ†äº« JSON æ–‡ä»¶ï¼ˆGit/é‚®ä»¶/äº‘ç›˜ï¼‰<br>3. æˆå‘˜å¯¼å…¥ | âœ… å®Œç¾ |

**ç»“è®º**: å¯¼å‡ºå¯¼å…¥æ˜¯å”¯ä¸€åˆç†çš„æ–¹æ¡ˆã€‚

---

### åœºæ™¯ 3: å¤šè®¾å¤‡å¼€å‘

**éœ€æ±‚**: åœ¨ 3 å°è®¾å¤‡ï¼ˆåŠå…¬å®¤ Macã€å®¶é‡Œ Windowsã€äº‘ç«¯ Linuxï¼‰é—´å®æ—¶åŒæ­¥é…ç½®

**è´¨ç–‘**:
1. æœ‰å¤šå°‘å¼€å‘è€…çœŸçš„è¿™æ ·å·¥ä½œï¼Ÿï¼ˆ< 1%ï¼‰
2. æœåŠ¡å•†é…ç½®çœŸçš„éœ€è¦å®æ—¶åŒæ­¥å—ï¼Ÿï¼ˆé…ç½®å˜æ›´é¢‘ç‡ < 1 æ¬¡/å‘¨ï¼‰
3. ä¸º < 1% çš„ç”¨æˆ·å¢åŠ  500 è¡Œä»£ç ï¼Œå€¼å¾—å—ï¼Ÿ

**Linus çš„åˆ¤æ–­**:
> "We don't add features for 1% of users. We add features for 80% of users."

---

## ä¸‰ã€å¤æ‚åº¦å¯¹æ¯”

### å¯¼å‡ºå¯¼å…¥ï¼ˆ~200 è¡Œä»£ç ï¼‰

```typescript
// Core
export function exportConfig(options: ExportOptions): ExportData {
  // 1. è¯»å–é…ç½®
  const codex = readJSON('~/.ccman/codex.json')
  const claude = readJSON('~/.ccman/claudecode.json')

  // 2. è½¬æ¢æ ¼å¼
  if (!options.includeApiKeys) {
    clearApiKeys(codex.providers)
    clearApiKeys(claude.providers)
  }

  // 3. è¿”å›
  return {
    version: VERSION,
    exportedAt: new Date().toISOString(),
    includeApiKeys: options.includeApiKeys,
    data: { codex, claudecode: claude }
  }
}

export function importConfig(data: ExportData, options: ImportOptions): ImportResult {
  // 1. ç‰ˆæœ¬æ£€æŸ¥
  checkVersion(data.version)

  // 2. å¤‡ä»½
  backupCurrentConfig()

  // 3. åˆå¹¶
  try {
    mergeConfig(data, options)
    return { success: true, ... }
  } catch (error) {
    restoreBackup()
    throw error
  }
}
```

**æ€»è®¡**: ~150 è¡Œ Core + ~50 è¡Œ CLI + ~100 è¡Œ Desktop = **~300 è¡Œ**

---

### WebDAV åŒæ­¥ï¼ˆ~700 è¡Œä»£ç ï¼‰

```typescript
// WebDAV å®¢æˆ·ç«¯
import { createClient } from 'webdav'

// é…ç½®ç®¡ç†
interface SyncConfig {
  webdav: {
    url: string
    username: string
    password: string        // éœ€è¦å®‰å…¨å­˜å‚¨
  }
  strategy: 'realtime' | 'periodic' | 'manual'
  conflictResolution: 'local-wins' | 'remote-wins' | 'ask-user'
}

// åŒæ­¥å¼•æ“
class SyncEngine {
  async sync(): Promise<void> {
    // 1. è¿æ¥ WebDAV
    const client = this.createClient()

    // 2. è·å–è¿œç¨‹é…ç½®
    const remote = await client.getFileContents('/ccman/config.json')

    // 3. å¯¹æ¯”æœ¬åœ°å’Œè¿œç¨‹
    const local = this.loadLocal()
    const conflicts = this.detectConflicts(local, remote)

    // 4. è§£å†³å†²çª
    if (conflicts.length > 0) {
      const resolved = await this.resolveConflicts(conflicts)
      this.applyResolution(resolved)
    }

    // 5. ä¸Šä¼ åˆ°è¿œç¨‹
    await client.putFileContents('/ccman/config.json', this.serialize(local))
  }

  detectConflicts(local: Config, remote: Config): Conflict[] {
    // å¤æ‚çš„å†²çªæ£€æµ‹é€»è¾‘
    // - æœ¬åœ°åˆ é™¤ + è¿œç¨‹ä¿®æ”¹
    // - æœ¬åœ°ä¿®æ”¹ + è¿œç¨‹åˆ é™¤
    // - æœ¬åœ°ä¿®æ”¹ + è¿œç¨‹ä¿®æ”¹ï¼ˆä¸åŒå€¼ï¼‰
  }

  async resolveConflicts(conflicts: Conflict[]): Promise<Resolution[]> {
    // æ ¹æ®ç­–ç•¥è§£å†³å†²çª
    // - local-wins: æœ¬åœ°ä¼˜å…ˆ
    // - remote-wins: è¿œç¨‹ä¼˜å…ˆ
    // - ask-user: å¼¹çª—è®©ç”¨æˆ·é€‰æ‹©
  }
}

// é”™è¯¯å¤„ç†
class SyncError extends Error {
  constructor(
    public code: 'NETWORK_ERROR' | 'AUTH_FAILED' | 'CONFLICT',
    message: string
  ) {
    super(message)
  }
}

// é˜Ÿåˆ—ï¼ˆå¤„ç†ç¦»çº¿åœºæ™¯ï¼‰
class SyncQueue {
  private queue: SyncOperation[] = []

  enqueue(op: SyncOperation): void {
    this.queue.push(op)
    this.persistQueue()
  }

  async processQueue(): Promise<void> {
    while (this.queue.length > 0) {
      const op = this.queue.shift()
      try {
        await this.execute(op)
      } catch (error) {
        this.queue.unshift(op)  // é‡æ–°å…¥é˜Ÿ
        throw error
      }
    }
  }
}

// UI é…ç½®
function WebDAVSettingsDialog() {
  return (
    <Dialog>
      <Input label="WebDAV URL" />
      <Input label="ç”¨æˆ·å" />
      <Input label="å¯†ç " type="password" />
      <Select label="åŒæ­¥ç­–ç•¥">
        <Option value="realtime">å®æ—¶åŒæ­¥</Option>
        <Option value="periodic">å®šæ—¶åŒæ­¥ï¼ˆæ¯ 5 åˆ†é’Ÿï¼‰</Option>
        <Option value="manual">æ‰‹åŠ¨åŒæ­¥</Option>
      </Select>
      <Select label="å†²çªè§£å†³">
        <Option value="local-wins">æœ¬åœ°ä¼˜å…ˆ</Option>
        <Option value="remote-wins">è¿œç¨‹ä¼˜å…ˆ</Option>
        <Option value="ask-user">è¯¢é—®æˆ‘</Option>
      </Select>
    </Dialog>
  )
}
```

**æ€»è®¡**: ~500 è¡Œ Core + ~100 è¡Œ CLI + ~100 è¡Œ Desktop + ~200 è¡Œæµ‹è¯• = **~900 è¡Œ**

---

## å››ã€ç»´æŠ¤æˆæœ¬

### å¯¼å‡ºå¯¼å…¥ç»´æŠ¤æˆæœ¬ï¼šğŸŸ¢ ä½

**æ½œåœ¨é—®é¢˜**:
1. ç‰ˆæœ¬å…¼å®¹æ€§ï¼ˆå·²æœ‰è¿ç§»æœºåˆ¶ï¼‰
2. æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼ˆJSON è§£æé”™è¯¯å¤„ç†ï¼‰

**ç»´æŠ¤å·¥ä½œé‡**: < 1 å°æ—¶/å¹´

---

### WebDAV åŒæ­¥ç»´æŠ¤æˆæœ¬ï¼šğŸ”´ é«˜

**æ½œåœ¨é—®é¢˜**:
1. WebDAV æœåŠ¡å™¨å…¼å®¹æ€§ï¼ˆiCloudã€Nextcloudã€ownCloudã€Synology ç­‰ï¼‰
2. ç½‘ç»œé”™è¯¯ï¼ˆè¶…æ—¶ã€è¿æ¥å¤±è´¥ã€ä»£ç†é—®é¢˜ï¼‰
3. è®¤è¯é—®é¢˜ï¼ˆå¯†ç è¿‡æœŸã€æœåŠ¡å™¨è¿ç§»ï¼‰
4. å†²çªåœºæ™¯ï¼ˆç”¨æˆ·æŠ¥å‘Šï¼šé…ç½®ä¸¢å¤±ã€åŒæ­¥å¤±è´¥ï¼‰
5. æ€§èƒ½é—®é¢˜ï¼ˆå¤§é…ç½®æ–‡ä»¶ã€æ…¢ç½‘ç»œï¼‰
6. å®‰å…¨é—®é¢˜ï¼ˆAPI Key æ³„éœ²ã€ä¸­é—´äººæ”»å‡»ï¼‰

**ç»´æŠ¤å·¥ä½œé‡**: ~10 å°æ—¶/å¹´ï¼ˆbug ä¿®å¤ã€å…¼å®¹æ€§æµ‹è¯•ã€ç”¨æˆ·æ”¯æŒï¼‰

---

## äº”ã€Linus çš„æœ€ç»ˆåˆ¤æ–­

### "Bad programmers worry about the code. Good programmers worry about data structures."

**WebDAV åŒæ­¥çš„æ•°æ®ç»“æ„é—®é¢˜**:
- æ•°æ®ä¸æ˜¯å¤©ç„¶åˆ†å¸ƒå¼çš„ï¼ˆé…ç½®æ–‡ä»¶ = å•æœºæ•°æ®ï¼‰
- å¼ºè¡Œåšåˆ†å¸ƒå¼ = å¼•å…¥å¤æ‚çš„å†²çªè§£å†³
- "å¦‚æœæ•°æ®ç»“æ„ä¸å¯¹ï¼Œå†å¤šä»£ç ä¹Ÿæ— æ³•ç®€åŒ–å®ƒ"

---

### "Theory and practice sometimes clash. Theory loses. Every single time."

**ç†è®ºä¸Š**: äº‘åŒæ­¥å¾ˆé…·ï¼Œç”¨æˆ·ä¸ç”¨æ‰‹åŠ¨å¯¼å‡ºå¯¼å…¥
**å®è·µä¸­**:
- ç”¨æˆ·é…ç½® WebDAV çš„æ—¶é—´ > å¯¼å‡ºå¯¼å…¥çš„æ—¶é—´
- å†²çªå¤„ç†çš„å¤æ‚åº¦ > ç”¨æˆ·çš„æ”¶ç›Š
- å®‰å…¨é£é™© > ä¾¿åˆ©æ€§

---

### "We don't add features for 1% of users."

**æ•°æ®**:
- éœ€è¦å¤šè®¾å¤‡å®æ—¶åŒæ­¥çš„ç”¨æˆ·: < 1%
- éœ€è¦æ¢ç”µè„‘è¿ç§»é…ç½®çš„ç”¨æˆ·: 100%
- éœ€è¦å›¢é˜Ÿå…±äº«é…ç½®çš„ç”¨æˆ·: 30%

**ç»“è®º**: å¯¼å‡ºå¯¼å…¥å·²ç»è¦†ç›–äº† 100% çš„çœŸå®éœ€æ±‚ã€‚

---

## å…­ã€æ›¿ä»£æ–¹æ¡ˆï¼ˆå¦‚æœç”¨æˆ·çœŸçš„éœ€è¦äº‘åŒæ­¥ï¼‰

### æ–¹æ¡ˆ 1: ç”¨æˆ·è‡ªå·±åŒæ­¥å¯¼å‡ºæ–‡ä»¶

```bash
# 1. è®¾ç½®å®šæ—¶å¯¼å‡º
crontab -e
# æ¯å¤©è‡ªåŠ¨å¯¼å‡º
0 0 * * * ccman export --output ~/Dropbox/ccman-backup.json

# 2. äº‘ç›˜è‡ªåŠ¨åŒæ­¥
# Dropbox/iCloud/OneDrive è‡ªåŠ¨åŒæ­¥ ~/Dropbox/

# 3. å¦ä¸€å°æœºå™¨éœ€è¦æ—¶å¯¼å…¥
ccman import ~/Dropbox/ccman-backup.json
```

**ä¼˜ç‚¹**:
- é›¶ä»£ç ï¼ˆç”¨æˆ·è‡ªå·±é…ç½®ï¼‰
- å®‰å…¨ï¼ˆç”¨æˆ·é€‰æ‹©çš„äº‘ç›˜ï¼‰
- çµæ´»ï¼ˆç”¨æˆ·æ§åˆ¶åŒæ­¥é¢‘ç‡ï¼‰

---

### æ–¹æ¡ˆ 2: Git ä»“åº“ï¼ˆGeek æ–¹å¼ï¼‰

```bash
# 1. åˆå§‹åŒ– Git ä»“åº“
cd ~/.ccman
git init
git add .
git commit -m "Initial config"
git remote add origin git@github.com:user/ccman-config.git
git push -u origin main

# 2. å¦ä¸€å°æœºå™¨å…‹éš†
cd ~
git clone git@github.com:user/ccman-config.git .ccman

# 3. æ›´æ–°é…ç½®
cd ~/.ccman
git pull
```

**ä¼˜ç‚¹**:
- ç‰ˆæœ¬æ§åˆ¶
- å†²çªè§£å†³ï¼ˆGit çš„ mergeï¼‰
- é€‚åˆ Geek ç”¨æˆ·

**ç¼ºç‚¹**:
- éœ€è¦æ‡‚ Git
- API Key ä¸èƒ½ä¸Šä¼ ï¼ˆéœ€è¦ .gitignoreï¼‰

---

## ä¸ƒã€æ€»ç»“

### âœ… å€¼å¾—åšï¼šå¯¼å‡ºå¯¼å…¥

**åŸå› **:
1. çœŸå®éœ€æ±‚ï¼ˆæ¢ç”µè„‘ã€å›¢é˜Ÿå…±äº«ï¼‰
2. ç®€å•å®ç°ï¼ˆ~300 è¡Œä»£ç ï¼‰
3. å®‰å…¨å¯æ§ï¼ˆå¯é€‰æ‹©ä¸å¯¼å‡º API Keyï¼‰
4. ç»´æŠ¤æˆæœ¬ä½

---

### âŒ ä¸å€¼å¾—åšï¼šWebDAV åŒæ­¥

**åŸå› **:
1. è‡†æƒ³çš„éœ€æ±‚ï¼ˆ< 1% ç”¨æˆ·ï¼‰
2. å¤æ‚å®ç°ï¼ˆ~900 è¡Œä»£ç ï¼‰
3. å®‰å…¨é£é™©ï¼ˆAPI Key åœ¨äº‘ç«¯ï¼‰
4. ç»´æŠ¤æˆæœ¬é«˜ï¼ˆç½‘ç»œã€å†²çªã€å…¼å®¹æ€§ï¼‰
5. æ›¿ä»£æ–¹æ¡ˆï¼ˆç”¨æˆ·è‡ªå·±åŒæ­¥å¯¼å‡ºæ–‡ä»¶ï¼‰

---

### Linus çš„è¯

> "This is solving a non-existent problem. The real problem is 'how to move config to a new machine', and export/import solves it perfectly. Cloud sync is just overengineering for the sake of engineering."

---

**æœ€ç»ˆå†³ç­–**: åªå®ç°å¯¼å‡ºå¯¼å…¥ï¼Œä¸åš WebDAV åŒæ­¥ã€‚
