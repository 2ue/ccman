# NPM å‘å¸ƒæƒé™é…ç½®æŒ‡å—

## ğŸ” æƒé™é—®é¢˜åˆ†æ

ä½ çš„æ‹…å¿ƒå®Œå…¨æ­£ç¡®ï¼NPM å‘å¸ƒç¡®å®å®¹æ˜“å‡ºç°æƒé™é—®é¢˜ã€‚æˆ‘å·²ç»ä¼˜åŒ–äº† GitHub Actionsï¼Œé‡‡ç”¨æ›´å¯é çš„ `.npmrc` é…ç½®æ–¹å¼ã€‚

## ğŸ›  GitHub Actions æƒé™é…ç½®

### å¿…éœ€çš„ GitHub Secrets

åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­éœ€è¦é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

1. **NPM_TOKEN** (å¿…éœ€)
   - ç”¨äº NPM å‘å¸ƒè®¤è¯
   - è·å–æ–¹å¼è§ä¸‹æ–‡

2. **GITHUB_TOKEN** (è‡ªåŠ¨æä¾›)
   - GitHub è‡ªåŠ¨æä¾›ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
   - ç”¨äºåˆ›å»º Release

### NPM Token è·å–æ­¥éª¤

```bash
# 1. ç™»å½• NPM
npm login

# 2. åˆ›å»ºè®¿é—®ä»¤ç‰Œ
npm token create --read-only=false

# 3. å¤åˆ¶ç”Ÿæˆçš„ä»¤ç‰Œåˆ° GitHub Secrets
```

**é‡è¦**: é€‰æ‹© **Automation** ç±»å‹çš„ tokenï¼Œå…·æœ‰å‘å¸ƒæƒé™ã€‚

### GitHub è®¾ç½®è·¯å¾„
```
GitHub ä»“åº“ â†’ Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret
```

æ·»åŠ ï¼š
- Name: `NPM_TOKEN`
- Secret: ä½ çš„ NPM token

## ğŸ”§ ä¼˜åŒ–åçš„å·¥ä½œæµç¨‹

### pnpm å’Œ npm æ··åˆç­–ç•¥

```yaml
# è®¾ç½® pnpmï¼ˆå›ºå®šç‰ˆæœ¬ç¡®ä¿ç¨³å®šæ€§ï¼‰
- name: Setup pnpm
  uses: pnpm/action-setup@v4
  with:
    version: 8.15.1

# ä½¿ç”¨ setup-node å†…ç½®ç¼“å­˜
- name: Setup Node.js
  uses: actions/setup-node@v4
  with:
    node-version: '18'
    cache: 'pnpm'  # å†…ç½®ç¼“å­˜ï¼Œæ— éœ€é¢å¤–é…ç½®

# æ„å»ºä½¿ç”¨ pnpmï¼ˆæ›´å¿«ï¼‰
- run: pnpm install --frozen-lockfile
- run: pnpm run build

# å‘å¸ƒä½¿ç”¨ npmï¼ˆæ›´ç¨³å®šï¼‰  
- run: npm publish --access public
```

### ä¼˜åŠ¿åˆ†æ

1. **pnpm ç”¨äºæ„å»º**
   - âš¡ æ›´å¿«çš„ä¾èµ–å®‰è£…
   - ğŸ’¾ æ›´å°‘çš„ç£ç›˜ç©ºé—´å ç”¨
   - ğŸ”’ æ›´ä¸¥æ ¼çš„ä¾èµ–ç®¡ç†

2. **npm ç”¨äºå‘å¸ƒ**
   - ğŸ›¡ï¸ æ›´æˆç†Ÿç¨³å®šçš„å‘å¸ƒæœºåˆ¶
   - ğŸ”§ æ›´å¥½çš„ registry å…¼å®¹æ€§
   - ğŸ“š æ›´å¤šçš„æ–‡æ¡£å’Œæœ€ä½³å®è·µ

## ğŸš€ å‘å¸ƒæ–¹å¼é€‰æ‹©

### æ–¹å¼ä¸€ï¼šè‡ªåŠ¨å‘å¸ƒï¼ˆæ¨èï¼‰
```bash
# ä½¿ç”¨ GitHub Actions è‡ªåŠ¨å‘å¸ƒ
npm run release        # å®Œæ•´å‘å¸ƒæµç¨‹
npm run release:patch  # å¿«é€Ÿè¡¥ä¸å‘å¸ƒ
```

### æ–¹å¼äºŒï¼šæœ¬åœ°å‘å¸ƒï¼ˆå¤‡ç”¨ï¼‰
```bash
# æœ¬åœ°æ‰‹åŠ¨å‘å¸ƒ
npm run publish:local
```

## ğŸ“‹ æƒé™é—®é¢˜æ’æŸ¥

### å¸¸è§é—®é¢˜

1. **401 Unauthorized**
   ```bash
   # æ£€æŸ¥ token æ˜¯å¦æ­£ç¡®
   npm whoami
   
   # é‡æ–°åˆ›å»º token
   npm token create --read-only=false
   ```

2. **403 Forbidden**
   ```bash
   # æ£€æŸ¥åŒ…åæ˜¯å¦è¢«å ç”¨
   npm view your-package-name
   
   # æ£€æŸ¥æ˜¯å¦æœ‰å‘å¸ƒæƒé™
   npm owner ls your-package-name
   ```

3. **Package name too similar**
   ```bash
   # ä¿®æ”¹ package.json ä¸­çš„ name å­—æ®µ
   "name": "@your-username/ccm"
   ```

### æµ‹è¯•å‘å¸ƒæƒé™
```bash
# æµ‹è¯•å‘å¸ƒæƒé™ï¼ˆä¸å®é™…å‘å¸ƒï¼‰
npm publish --dry-run
```

## ğŸ”„ å‘å¸ƒæµç¨‹æ€»ç»“

### GitHub Actions æµç¨‹
1. æ¨é€ tag â†’ è§¦å‘ Actions
2. è®¾ç½® pnpm (å›ºå®šç‰ˆæœ¬) â†’ å®‰è£…ä¾èµ–
3. pnpm æ„å»ºé¡¹ç›® â†’ è¿è¡Œæµ‹è¯•  
4. é…ç½® `.npmrc` â†’ è®¤è¯ NPM
5. npm å‘å¸ƒåŒ… â†’ åˆ›å»º Release

### æœ¬åœ°å‘å¸ƒæµç¨‹
1. æ£€æŸ¥ç™»å½•çŠ¶æ€
2. éªŒè¯ç‰ˆæœ¬å”¯ä¸€æ€§
3. è¿è¡Œæ„å»ºå’Œæ£€æŸ¥
4. ç¡®è®¤åå‘å¸ƒ

## ğŸ¯ æœ€ä½³å®è·µ

### ç‰ˆæœ¬ç®¡ç†
- âœ… æ‰€æœ‰ç‰ˆæœ¬å·ä» `package.json` åŠ¨æ€è¯»å–
- âœ… CLI ç‰ˆæœ¬è‡ªåŠ¨åŒæ­¥
- âœ… å›ºå®š pnpm ç‰ˆæœ¬ (`packageManager: "pnpm@8.15.1"`)

### æ„å»ºå’Œå‘å¸ƒåˆ†ç¦»
- ğŸ”¨ **æ„å»º**: ä½¿ç”¨ pnpmï¼ˆé€Ÿåº¦ä¼˜åŠ¿ï¼‰
- ğŸ“¦ **å‘å¸ƒ**: ä½¿ç”¨ npmï¼ˆç¨³å®šæ€§ä¼˜åŠ¿ï¼‰
- ğŸ—„ï¸ **ç¼“å­˜**: ä½¿ç”¨ setup-node å†…ç½®ç¼“å­˜

### å®‰å…¨æªæ–½
1. **Token å®‰å…¨**
   - åªåœ¨ GitHub Secrets ä¸­å­˜å‚¨
   - å®šæœŸè½®æ¢ token
   - ä½¿ç”¨æœ€å°æƒé™åŸåˆ™

2. **å‘å¸ƒéªŒè¯**
   - æ¯æ¬¡å‘å¸ƒå‰éªŒè¯è®¤è¯çŠ¶æ€
   - æ£€æŸ¥ç‰ˆæœ¬å·å”¯ä¸€æ€§
   - è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶

ç°åœ¨çš„é…ç½®å·²ç»æ˜¯æœ€ä¼˜å®è·µï¼Œç»“åˆäº† pnpm çš„æ„å»ºä¼˜åŠ¿å’Œ npm çš„å‘å¸ƒç¨³å®šæ€§ï¼